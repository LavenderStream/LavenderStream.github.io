<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="RxAndroid and Retrofit 2.0一关于Rx的学习我参考了这篇博客，是我在网上看到的博客中写的比较全的http://blog.csdn.net/meegomeego/article/details/49155989/ Retrofit 2.0还是测试版， 主要是‘领导’说Retrofit 比okHttp 和 Volley要好，今天弄了下，例子是照retrofit官网敲的。http">
<meta name="keywords" content="top">
<meta property="og:type" content="article">
<meta property="og:title" content="Android -- RxAndroid and Retrofit 2.0学习笔记">
<meta property="og:url" content="https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/index.html">
<meta property="og:site_name" content="Tiny hexo">
<meta property="og:description" content="RxAndroid and Retrofit 2.0一关于Rx的学习我参考了这篇博客，是我在网上看到的博客中写的比较全的http://blog.csdn.net/meegomeego/article/details/49155989/ Retrofit 2.0还是测试版， 主要是‘领导’说Retrofit 比okHttp 和 Volley要好，今天弄了下，例子是照retrofit官网敲的。http">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-1c12f1c35d7054d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-77e240dc8ab5101a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-10d3d6caafcf99e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-4dbef7bcf0d76aa0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-7ce8b379720d41c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-10-27T05:25:43.542Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android -- RxAndroid and Retrofit 2.0学习笔记">
<meta name="twitter:description" content="RxAndroid and Retrofit 2.0一关于Rx的学习我参考了这篇博客，是我在网上看到的博客中写的比较全的http://blog.csdn.net/meegomeego/article/details/49155989/ Retrofit 2.0还是测试版， 主要是‘领导’说Retrofit 比okHttp 和 Volley要好，今天弄了下，例子是照retrofit官网敲的。http">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1285832-1c12f1c35d7054d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Android -- RxAndroid and Retrofit 2.0学习笔记</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
    <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
    <span id="menu">
    <span id="nav">
      <ul>
          
          
          <li><a href="/">Home</a></li>
          
          
          <li><a href="/archives/">Writing</a></li>
          
          
          <li><a href="https://www.jianshu.com/u/4215db84d54e" target="_blank">JianShu</a></li>
          
          
          <li><a href="https://github.com/LavenderStream" target="_blank">GitHub</a></li>
          
          
          <li><a href="/about/">About</a></li>
          
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
          
          <li><a class="icon" href="/2016/06/17/Android-修改状态栏文字颜色/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
          
          
          <li><a class="icon" href="/2016/01/20/Android-应用差量更新/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
          
          <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&text=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&is_video=false&description=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android -- RxAndroid and Retrofit 2.0学习笔记&body=Check out this article: https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&name=Android -- RxAndroid and Retrofit 2.0学习笔记&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RxAndroid-and-Retrofit-2-0"><span class="toc-number">1.</span> <span class="toc-text">RxAndroid and Retrofit 2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一"><span class="toc-number">1.0.1.</span> <span class="toc-text">一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二"><span class="toc-number">1.0.2.</span> <span class="toc-text">二</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#Retrofit"><span class="toc-number">2.</span> <span class="toc-text">Retrofit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Introduction"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API-Declaration"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">API Declaration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#REQUEST-METHOD"><span class="toc-number">2.0.0.2.1.</span> <span class="toc-text">REQUEST METHOD</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL-MANIPULATION"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">URL MANIPULATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REQUEST-BODY"><span class="toc-number">2.0.0.4.</span> <span class="toc-text">REQUEST BODY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FORM-ENCODED-AND-MULTIPART"><span class="toc-number">2.0.0.5.</span> <span class="toc-text">FORM ENCODED AND MULTIPART</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HEADER-MANIPULATION"><span class="toc-number">2.0.0.6.</span> <span class="toc-text">HEADER MANIPULATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#END"><span class="toc-number">2.0.0.7.</span> <span class="toc-text">END</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三"><span class="toc-number">3.</span> <span class="toc-text">三</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#二、继续尝试"><span class="toc-number">3.0.1.</span> <span class="toc-text">二、继续尝试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、呃……还是尝试"><span class="toc-number">3.0.2.</span> <span class="toc-text">三、呃……还是尝试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、迷之变幻"><span class="toc-number">3.0.3.</span> <span class="toc-text">三、迷之变幻</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、线程切换"><span class="toc-number">3.0.4.</span> <span class="toc-text">四、线程切换</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#总结-初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧"><span class="toc-number">3.0.4.0.1.</span> <span class="toc-text">总结:初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#大概一个月之前看了看Retrofit进行网络接口，-这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。"><span class="toc-number">4.</span> <span class="toc-text">大概一个月之前看了看Retrofit进行网络接口， 这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。</span></a></li>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Android -- RxAndroid and Retrofit 2.0学习笔记
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">Tiny</span>
      </span>
      
    <div class="postdate">
        <time datetime="2016-04-08T03:07:00.000Z" itemprop="datePublished">2016-04-08</time>
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/top/">top</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="RxAndroid-and-Retrofit-2-0"><a href="#RxAndroid-and-Retrofit-2-0" class="headerlink" title="RxAndroid and Retrofit 2.0"></a>RxAndroid and Retrofit 2.0</h1><h3 id="一"><a href="#一" class="headerlink" title="一"></a>一</h3><p>关于Rx的学习我参考了这篇博客，是我在网上看到的博客中写的比较全的<br><a href="http://blog.csdn.net/meegomeego/article/details/49155989/" target="_blank" rel="noopener">http://blog.csdn.net/meegomeego/article/details/49155989/</a></p>
<p>Retrofit 2.0还是测试版， 主要是‘领导’说Retrofit 比okHttp 和 Volley要好，今天弄了下，例子是照retrofit官网敲的。<br><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">http://square.github.io/retrofit/</a></p>
<h3 id="二"><a href="#二" class="headerlink" title="二"></a>二</h3><p>设计还在弄设计图，闲的没什么事，翻译一下retrofit的官网吧</p>
<h1 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h1><p>A type-safe <strong>HTTP client</strong> for Android and Java（蛋疼，这句怎么翻译）</p>
<h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>Retrofit让你的http api 变成java接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface GitHubService &#123; </span><br><span class="line">  @GET(&quot;users/&#123;user&#125;/repos&quot;)</span><br><span class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path(&quot;user&quot;) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Retrofit会生成一个GitHubService接口的实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder() </span><br><span class="line">.baseUrl(&quot;https://api.github.com/&quot;) </span><br><span class="line">.build();</span><br><span class="line"></span><br><span class="line">GitHubService service = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure></p>
<p>每一个GitHubService的回调，都会make一个同步或者异步的http请求到远程的webserver<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos(&quot;octocat&quot;);</span><br></pre></td></tr></table></figure></p>
<p>使用注解去描述http请求</p>
<ul>
<li>url参数支持替换和查询</li>
<li>对象转换到请求体</li>
<li>复合的请求体和文件上传</li>
</ul>
<h4 id="API-Declaration"><a href="#API-Declaration" class="headerlink" title="API Declaration"></a>API Declaration</h4><p>注解的方法和他的参数怎样处理一个请求</p>
<h5 id="REQUEST-METHOD"><a href="#REQUEST-METHOD" class="headerlink" title="REQUEST METHOD"></a>REQUEST METHOD</h5><p>每一个方法必须有一个http的注解，他提供了一个请求的方法和一个相对的url。一共有5中注解GET, POST, PUT, DELETE, and HEAD。资源的相对url在注解中规定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;users/list&quot;)</span><br></pre></td></tr></table></figure></p>
<p>还可以指定url的查询参数<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;users/list?sort=desc&quot;)</span><br></pre></td></tr></table></figure></p>
<h4 id="URL-MANIPULATION"><a href="#URL-MANIPULATION" class="headerlink" title="URL MANIPULATION"></a>URL MANIPULATION</h4><p>一个请求的url中的参数和blocks可以被动态的替换，这个blocks要被{}包围。这个参数要使用@Path注解，并且使用同一个字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId);</span><br></pre></td></tr></table></figure></p>
<p>查寻参数也可以被添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId, @Query(&quot;sort&quot;) String sort);</span><br></pre></td></tr></table></figure></p>
<p>对于相对复杂的查询参数也可以使用map<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId, @QueryMap Map&lt;String, String&gt; options);</span><br></pre></td></tr></table></figure></p>
<h4 id="REQUEST-BODY"><a href="#REQUEST-BODY" class="headerlink" title="REQUEST BODY"></a>REQUEST BODY</h4><p>使用@Body注解可以指定一个对象作为HTTP请求体。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@POST(&quot;users/new&quot;)</span><br><span class="line">Call&lt;User&gt; createUser(@Body User user);</span><br></pre></td></tr></table></figure></p>
<p>这个对象也可以使用一个Retrofit的实例指定的一个转换器转换，如果没有添加这个转换器，就会使用RequestBody（没看懂）</p>
<h4 id="FORM-ENCODED-AND-MULTIPART"><a href="#FORM-ENCODED-AND-MULTIPART" class="headerlink" title="FORM ENCODED AND MULTIPART"></a>FORM ENCODED AND MULTIPART</h4><p>方法也可以用来生命发送表单编码和符合数据<br>表单编码的数据发送当@FormUrlEncoded存在的方法。每个键-值对注释@Field包含名称和对象提供的价值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;user/edit&quot;)</span><br><span class="line">Call&lt;User&gt; updateUser(@Field(&quot;first_name&quot;) String first, @Field(&quot;last_name&quot;) String last);</span><br></pre></td></tr></table></figure></p>
<p>多部分请求时使用@Multipart存在的方法。部分使用@Part注释声明。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">@PUT(&quot;user/photo&quot;)</span><br><span class="line">Call&lt;User&gt; updateUser(@Part(&quot;photo&quot;) RequestBody photo, @Part(&quot;description&quot;)</span><br><span class="line">RequestBody description);</span><br></pre></td></tr></table></figure></p>
<p>部分部件采用改造的转换器，也可以实现RequestBody处理自己的序列化。</p>
<h4 id="HEADER-MANIPULATION"><a href="#HEADER-MANIPULATION" class="headerlink" title="HEADER MANIPULATION"></a>HEADER MANIPULATION</h4><p>可以使用@Headers注释的方法设置静态头。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Headers(&quot;Cache-Control: max-age=640000&quot;)</span><br><span class="line">@GET(&quot;widget/list&quot;)</span><br><span class="line">Call&lt;List&lt;Widget&gt;&gt; widgetList();</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Headers(&#123; &quot;Accept: application/vnd.github.v3.full+json&quot;, &quot;User-Agent: Retrofit-Sample-App&quot;&#125;)</span><br><span class="line">@GET(&quot;users/&#123;username&#125;&quot;)</span><br><span class="line">Call&lt;User&gt; getUser(@Path(&quot;username&quot;) String username);</span><br></pre></td></tr></table></figure>
<p>注意,头不会互相覆盖。具有相同名称的所有头文件都包括在请求</p>
<h4 id="END"><a href="#END" class="headerlink" title="END"></a>END</h4><p>后面的说的就不往上粘了，因为我也看不懂</p>
<p>在运行例子的时候遇见了一些问题，当时看了一些其他的博客，GitHubService 是作为参数回掉的，返回值是空，运行的过程提示GitHubService 的返回值不能使空了， 不知道是不是2.0和之前的差别<br>接下来就是在Rx中使用Retrofit了</p>
<h1 id="三"><a href="#三" class="headerlink" title="三"></a>三</h1><p>按照官网的做法<br>创建了一个GitHubService，这个接口简单的写了两个方法，第一个方法在RX中使用了Retrofit，要注意的就是每个请求前面都是/<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public interface GitHubService</span><br><span class="line"> &#123;</span><br><span class="line">    @GET(&quot;/&#123;users&#125;/mobilesiri&quot;)</span><br><span class="line">    Observable&lt;Repo&gt; getUser(@Path(&quot;users&quot;) String user);</span><br><span class="line"></span><br><span class="line">    @GET(&quot;/users/mobilesiri&quot;)</span><br><span class="line">    Call&lt;Repo&gt; getUser2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里没使用官网上给的api接口，用的是<a href="https://api.github.com/users/mobilesiri" target="_blank" rel="noopener">https://api.github.com/users/mobilesiri</a><br>官网上面的数据太多了，然后用JsonFromat生成了一个bean 叫 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接着就是主要的内容了</span><br><span class="line">baseUrl是请求的通用的部分，这里设定的就是</span><br></pre></td></tr></table></figure></p>
<p>private static final String URI = “<a href="https://api.github.com&quot;" target="_blank" rel="noopener">https://api.github.com&quot;</a>;<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addConverterFactory 这个是设置用Gson转换，也可以自定义， 但自定义这个后面再说吧</span><br><span class="line">addCallAdapterFactory 这个在Rx中使用的话要添加</span><br><span class="line">还有提个坑就是这个依赖，一定要对应，版本不对，网又不好，在这弄了半天</span><br><span class="line">```gradle</span><br><span class="line">compile <span class="string">'com.squareup.retrofit:retrofit:2.0.0-beta2'</span></span><br><span class="line">compile <span class="string">'com.squareup.retrofit:adapter-rxjava:2.0.0-beta2'</span></span><br><span class="line">compile <span class="string">'com.squareup.retrofit:converter-gson:2.0.0-beta2'</span></span><br></pre></td></tr></table></figure></p>
<p>Rx也跟最新的版本就行了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">.baseUrl(URI)</span><br><span class="line">.addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">.addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">.build();</span><br></pre></td></tr></table></figure></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GitHubService gitHubService = retrofit.create(GitHubService.class);</span><br><span class="line">Call&lt;Repo&gt; repos2 = gitHubService.getUser2();</span><br><span class="line"></span><br><span class="line">repos2.enqueue(<span class="keyword">new</span> Callback&lt;Repo&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> onResponse(Response&lt;Repo&gt; response,</span><br><span class="line">                    Retrofit retrofit) &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<p>以上是没有用Rx的代码<br>下面就是在Rx中使用Retrofit的代码了，完成一次网络请求，从实现上来说还是很简单的<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">gitHubService</span><span class="selector-class">.getUser</span>(<span class="string">"users"</span>)<span class="selector-class">.subscribeOn</span>(Schedulers.io())</span><br><span class="line">             <span class="selector-class">.observeOn</span>(AndroidSchedulers.mainThread())</span><br><span class="line">             <span class="selector-class">.subscribe</span>(new Action1&lt;Repo&gt;() &#123;</span><br><span class="line">                  <span class="variable">@Override</span></span><br><span class="line">                  public void call(Repo repo) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure></p>
<p>subscribeOn 指定的是observe运行线程；observeOn是subscribe的运行线程，呃……<br>当然subscribe中new 一个 Subscriber去实现<figure class="highlight plain"><figcaption><span>```onError``` ```onNext```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">以上就是在Rx中使用Retrofit做网络请求的基本方法了</span><br><span class="line"></span><br><span class="line">——————————————————————————————--</span><br><span class="line"> # RxAndroid</span><br><span class="line"> ##### Observable （被观察者）</span><br><span class="line">##### Subscribers （订阅者）</span><br><span class="line">Observable 我理解成了事件的发送者，Subscribers为事件的处理，这样方便理解吧……默背十遍，记住这两个概念，省得记混。</span><br><span class="line">下面就照网上的教程敲一个小例子吧！！！</span><br><span class="line">### 一、尝试</span><br><span class="line">* 导入rx所需要的包</span><br><span class="line">```android</span><br><span class="line">compile &apos;io.reactivex:rxandroid:1.2.1&apos;</span><br><span class="line">compile &apos;io.reactivex:rxjava:1.1.6&apos;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>大概的思路是创建一个消息的发送者和接收者，然后将他们链接起来，和大象一样，也是分三步：<br>第一个例子啥也不说了，直接上代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tiny.rxandrioddemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> rx.Observable;</span><br><span class="line"><span class="keyword">import</span> rx.Subscriber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</span><br><span class="line">    <span class="keyword">private</span> Observable&lt;String&gt; mObservable;</span><br><span class="line">    <span class="keyword">private</span> Subscriber&lt;String&gt; mSubscriber;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        createObservable();</span><br><span class="line">        createSubscriber();</span><br><span class="line">        bindEvent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bindEvent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mObservable.subscribe(mSubscriber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createSubscriber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mSubscriber = <span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG, <span class="string">"onNext: "</span> + s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mObservable = Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;?<span class="keyword">super</span> String&gt; subscriber)</span> </span>&#123;</span><br><span class="line">                        subscriber.onNext(<span class="string">"haha"</span>);</span><br><span class="line">                        subscriber.onCompleted();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二、继续尝试"><a href="#二、继续尝试" class="headerlink" title="二、继续尝试"></a>二、继续尝试</h3><p>看到了rx中有from just ……这些东西， 看看这个是干嘛的吧， 之后一顿百度：<br>rx提供了一些快捷创建事件队列的方式，就上上面一行中提到的just和from了</p>
<ul>
<li>just(T…): 将传入的参数依次发送出来。</li>
<li>from(T[])/ from(Iterable&lt;? extends T&gt;): 将传入的数组或 Iterable拆分成具体对象后，依次发送出来。<br>依然还是先上代码了，上面的方法简化成下边这样<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private void createObservable() &#123;</span><br><span class="line">    mObservable = Observable.just(&quot;ha1&quot;, &quot;ha2&quot;, &quot;ha3&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>程序调用了三次doNext 一次 onComleted<br><img src="http://upload-images.jianshu.io/upload_images/1285832-1c12f1c35d7054d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>再将上面的代码改成这样, 也是ok的<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createObservable</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">List&lt;String&gt; eventList = <span class="keyword">new</span> ArrayList&lt;&gt;();    </span><br><span class="line">eventList.<span class="keyword">add</span>(<span class="string">"haha1"</span>); </span><br><span class="line">eventList.<span class="keyword">add</span>(<span class="string">"haha2"</span>);    </span><br><span class="line">eventList.<span class="keyword">add</span>(<span class="string">"haha3"</span>);   </span><br><span class="line">mObservable = Observable.<span class="keyword">from</span>(eventList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="三、呃……还是尝试"><a href="#三、呃……还是尝试" class="headerlink" title="三、呃……还是尝试"></a>三、呃……还是尝试</h3><p>和上面一样，事件的发送者简化了，那么还想简化一下事件的处理，之后发现了actionx 这个方法，那么就改一下createSubscriber()<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="literal">void</span> createSubscriber()&#123;</span><br><span class="line">    mSubscriberAction = <span class="literal">new</span> Action1&lt;<span class="built_in">String</span>&gt;()&#123; </span><br><span class="line">        @Override</span><br><span class="line">        <span class="keyword">public</span> <span class="literal">void</span> call(<span class="built_in">String</span> s)&#123;</span><br><span class="line">            <span class="keyword">Log</span>.d(<span class="built_in">TAG</span>, <span class="string">"call: "</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是输出结果</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-77e240dc8ab5101a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h3 id="三、迷之变幻"><a href="#三、迷之变幻" class="headerlink" title="三、迷之变幻"></a>三、迷之变幻</h3><ul>
<li>map(): 事件对象的直接变换，可以将一个对象转变成另一个对象。它是 RxJava 最常用的变换</li>
<li>flatMap()：这个事件比较复杂，就举个网上的例子来说明吧<br>参考了博客<a href="http://blog.csdn.net/daditao/article/details/50606228" target="_blank" rel="noopener">http://blog.csdn.net/daditao/article/details/50606228</a><br>首先假设这么一种需求：假设有一个<a href="http://lib.csdn.net/base/datastructure" target="_blank" rel="noopener">数据结构</a>『学生』，现在需要打印出一组学生的名字。实现方式很简单：</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-10d3d6caafcf99e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>很简单。那么再假设：如果要打印出每个学生所需要修的所有课程的名称呢？（需求的区别在于，每个学生只有一个名字，但却有多个课程。）首先可以这样实现：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-4dbef7bcf0d76aa0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>我哟啊是不想用for循环来输出也可以这么写</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-7ce8b379720d41c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>这样就简单了<br>具体详细的可以看上面链接中的博客，就比较全面了</p>
<ul>
<li>Funcx：在变换中，使用了Funcx这个方法，这个方法同Actionx一样理解，但是Funcx一些列的方法是带有返回值的</li>
</ul>
<h3 id="四、线程切换"><a href="#四、线程切换" class="headerlink" title="四、线程切换"></a>四、线程切换</h3><p>写代码测试之后，发现RxAndroid 中可以使用observeOn 方法来切换线程，但是还没有摸清subscribeOn方法是干什么用的。<br>之前以为observeOn是设置Observable的运行线程；而subscribeOn是规定了subscribe的线程</p>
<h5 id="总结-初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧"><a href="#总结-初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧" class="headerlink" title="总结:初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧"></a>总结:初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧</h5><h1 id="大概一个月之前看了看Retrofit进行网络接口，-这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。"><a href="#大概一个月之前看了看Retrofit进行网络接口，-这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。" class="headerlink" title="大概一个月之前看了看Retrofit进行网络接口， 这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。"></a>大概一个月之前看了看Retrofit进行网络接口， 这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。</h1><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tiny.rxandrioddemo.mkmy.net.net;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.FormBody;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Interceptor;</span><br><span class="line"><span class="keyword">import</span> okhttp3.MediaType;</span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Request;</span><br><span class="line"><span class="keyword">import</span> retrofit2.CallAdapter;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Converter;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Retrofit;</span><br><span class="line"><span class="keyword">import</span> retrofit2.adapter.rxjava.RxJavaCallAdapterFactory;</span><br><span class="line"><span class="keyword">import</span> retrofit2.converter.gson.GsonConverterFactory;</span><br><span class="line"><span class="keyword">import</span> tiny.rxandrioddemo.App;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RetrofitUtil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final <span class="keyword">String</span> TAG = <span class="string">"RetrofitUtil"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final Converter.Factory gsonConverterFactory = GsonConverterFactory.create();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final CallAdapter.Factory rxJavaCallAdapterFactory = RxJavaCallAdapterFactory.create();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final MediaType JSON</span><br><span class="line">            = MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Retrofit getRetrofit(<span class="keyword">String</span> baseUrl)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">Retrofit</span>.Builder()</span><br><span class="line">                .client(okHttpClientConfig())</span><br><span class="line">                .baseUrl(baseUrl)</span><br><span class="line">                .addConverterFactory(gsonConverterFactory)</span><br><span class="line">                .addCallAdapterFactory(rxJavaCallAdapterFactory)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpClient okHttpClientConfig()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">OkHttpClient</span>.Builder()</span><br><span class="line">                .addInterceptor(<span class="keyword">new</span> <span class="type">LogInterceptor</span>())</span><br><span class="line">                .connectTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void cancel()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LogInterceptor</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Interceptor</span></span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="keyword">public</span> okhttp3.Response intercept(Chain chain) throws IOException</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            Request originalRequest = chain.request();</span><br><span class="line"></span><br><span class="line">            Request.Builder originalRequestBuilder = chain.request().<span class="keyword">new</span><span class="type">Builder</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//  headers</span></span><br><span class="line">            <span class="keyword">String</span> userAgent = System.getProperty(<span class="string">"http.agent"</span>);</span><br><span class="line">            userAgent = App.getInstance().getChannelName() +</span><br><span class="line">                    <span class="string">"/"</span> + App.getInstance().getVersionName()</span><br><span class="line">                    + <span class="string">" "</span> + userAgent;</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept userAgent : "</span> + userAgent);</span><br><span class="line">            originalRequestBuilder.addHeader(<span class="string">"User-Agent"</span>, userAgent);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">String</span> session = App.getInstance().getSp(<span class="string">"PHPSESSID"</span>);</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept session : "</span> + session);</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(session))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//originalRequestBuilder.addHeader("Cookie", "PHPSESSID=ndi4uke0r1thf9m1taimv078u3");</span></span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept body: "</span> + (originalRequest.body() instanceof FormBody));</span><br><span class="line">            <span class="keyword">if</span> (originalRequest.body() instanceof FormBody)</span><br><span class="line">            &#123;</span><br><span class="line">                FormBody originalBody = (FormBody) originalRequest.body();</span><br><span class="line">                FormBody.Builder <span class="keyword">new</span><span class="type">FormBody</span> = <span class="keyword">new</span> <span class="type">FormBody</span>.Builder();</span><br><span class="line"></span><br><span class="line">                Log.d(TAG, <span class="string">"intercept POST sizer: "</span> + originalBody.size());</span><br><span class="line">                <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; originalBody.size(); i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">"intercept fied: "</span> + originalBody.encodedName(i));</span><br><span class="line">                    <span class="keyword">if</span> (!originalBody.encodedName(i).equals(<span class="string">"nu"</span>))</span><br><span class="line">                        <span class="keyword">new</span><span class="type">FormBody</span>.addEncoded(originalBody.encodedName(i), originalBody.encodedValue(i));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">String</span>[] values = App.getInstance().getNetInfo();</span><br><span class="line">                <span class="keyword">if</span> (!TextUtils.isEmpty(values[<span class="number">0</span>]) &amp;&amp; !TextUtils.isEmpty(values[<span class="number">1</span>]))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">new</span><span class="type">FormBody</span>.add(<span class="string">"sig"</span>, values[<span class="number">0</span>]);</span><br><span class="line">                    Log.d(TAG, <span class="string">"intercept sig: "</span> + values[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">new</span><span class="type">FormBody</span>.add(<span class="string">"timestamp"</span>, values[<span class="number">1</span>]);</span><br><span class="line">                    Log.d(TAG, <span class="string">"intercept timestamp: "</span> + values[<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                originalRequestBuilder.method(originalRequest.method(), <span class="keyword">new</span><span class="type">FormBody</span>.build());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Request req = originalRequestBuilder.build();</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept: x: "</span> + req.headers().toString());</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept: method: "</span> + req.method());</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept: url: "</span> + req.url());</span><br><span class="line">            Log.d(TAG, <span class="string">"intercept: body: "</span> + req.body());</span><br><span class="line"></span><br><span class="line">            okhttp3.Response response = chain.proceed(req);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (response.body() != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">String</span> mHeader = response.headers().toString();</span><br><span class="line">                    Log.i(TAG, <span class="string">"intercept: header1: "</span> + mHeader);</span><br><span class="line">                    Pattern pattern = Pattern.compile(<span class="string">"Set-Cookie.*?;"</span>);</span><br><span class="line">                    Matcher m = pattern.matcher(mHeader);</span><br><span class="line">                    <span class="keyword">String</span> cookieFromResponse = <span class="string">""</span>;</span><br><span class="line">                    <span class="keyword">if</span> (m.find())</span><br><span class="line">                    &#123;</span><br><span class="line">                        cookieFromResponse = m.group();</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.i(TAG, <span class="string">"intercept: header2: "</span> + cookieFromResponse);</span><br><span class="line">                    <span class="comment">// 去掉cookie末尾的分号</span></span><br><span class="line">                    <span class="comment">// cookieFromResponse = cookieFromResponse.substring(11, cookieFromResponse.length() - 1);</span></span><br><span class="line">                    App.getInstance().setSp(<span class="string">"PHPSESSID"</span>, cookieFromResponse);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">                &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://www.jianshu.com/u/4215db84d54e">JianShu</a></li>
         
          <li><a href="https://github.com/LavenderStream">GitHub</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RxAndroid-and-Retrofit-2-0"><span class="toc-number">1.</span> <span class="toc-text">RxAndroid and Retrofit 2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一"><span class="toc-number">1.0.1.</span> <span class="toc-text">一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二"><span class="toc-number">1.0.2.</span> <span class="toc-text">二</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#Retrofit"><span class="toc-number">2.</span> <span class="toc-text">Retrofit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Introduction"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API-Declaration"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">API Declaration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#REQUEST-METHOD"><span class="toc-number">2.0.0.2.1.</span> <span class="toc-text">REQUEST METHOD</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URL-MANIPULATION"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">URL MANIPULATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REQUEST-BODY"><span class="toc-number">2.0.0.4.</span> <span class="toc-text">REQUEST BODY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FORM-ENCODED-AND-MULTIPART"><span class="toc-number">2.0.0.5.</span> <span class="toc-text">FORM ENCODED AND MULTIPART</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HEADER-MANIPULATION"><span class="toc-number">2.0.0.6.</span> <span class="toc-text">HEADER MANIPULATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#END"><span class="toc-number">2.0.0.7.</span> <span class="toc-text">END</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三"><span class="toc-number">3.</span> <span class="toc-text">三</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#二、继续尝试"><span class="toc-number">3.0.1.</span> <span class="toc-text">二、继续尝试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、呃……还是尝试"><span class="toc-number">3.0.2.</span> <span class="toc-text">三、呃……还是尝试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、迷之变幻"><span class="toc-number">3.0.3.</span> <span class="toc-text">三、迷之变幻</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、线程切换"><span class="toc-number">3.0.4.</span> <span class="toc-text">四、线程切换</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#总结-初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧"><span class="toc-number">3.0.4.0.1.</span> <span class="toc-text">总结:初学到这了，基本上可以拿Rxandroid写一个例子，在写例子的时候在慢慢学习Rx吧</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#大概一个月之前看了看Retrofit进行网络接口，-这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。"><span class="toc-number">4.</span> <span class="toc-text">大概一个月之前看了看Retrofit进行网络接口， 这把手里的这个应用的网络层改成Retrofit，但是公司的应用，请求的时候都要改header和post，弄了一下，随后就又开始加班了（艹）。之前打的都快忘了，还是趁着空闲的时间先记下来吧。</span></a></li>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&text=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&is_video=false&description=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android -- RxAndroid and Retrofit 2.0学习笔记&body=Check out this article: https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&title=Android -- RxAndroid and Retrofit 2.0学习笔记"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lavenderstream.github.io/2016/04/08/Android-RxAndroid-and-Retrofit-2-0学习笔记/&name=Android -- RxAndroid and Retrofit 2.0学习笔记&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
    <div class="footer-left">
        Copyright &copy; 2020 by Tiny
    </div>
    <div class="footer-right">
        <nav>
            <ul>
                
                
                <li><a href="/">Home</a></li>
                
                
                <li><a href="/archives/">Writing</a></li>
                
                
                <li><a href="https://www.jianshu.com/u/4215db84d54e" target="_blank">JianShu</a></li>
                
                
                <li><a href="https://github.com/LavenderStream" target="_blank">GitHub</a></li>
                
                
                <li><a href="/about/">About</a></li>
                
            </ul>
        </nav>
    </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/plugin.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


