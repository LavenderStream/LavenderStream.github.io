<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Rxjava 2.x正式版出来已经快两个月了。在之前的项目中也在使用Rx。但却一直没有时间对整个的知识进行梳理，恰好今天抽出时间，也系统的再学习一遍RxJava/RxAndroid  RxJava的使用一、观察者/被观察者1、前奏：在观察者之前就要先提下backpressure这个概念。简单来说，backpressure是在异步场景中，被观察者发送事件速度远快于观察者的处理速度时，告诉被观察者降低">
<meta name="keywords" content="top">
<meta property="og:type" content="article">
<meta property="og:title" content="Android -- RxAndroid 2.0 学习笔记">
<meta property="og:url" content="https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/index.html">
<meta property="og:site_name" content="Tiny hexo">
<meta property="og:description" content="Rxjava 2.x正式版出来已经快两个月了。在之前的项目中也在使用Rx。但却一直没有时间对整个的知识进行梳理，恰好今天抽出时间，也系统的再学习一遍RxJava/RxAndroid  RxJava的使用一、观察者/被观察者1、前奏：在观察者之前就要先提下backpressure这个概念。简单来说，backpressure是在异步场景中，被观察者发送事件速度远快于观察者的处理速度时，告诉被观察者降低">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-79b2c34ae347d7a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1285832-79ec842b4f155cb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-10-27T05:22:20.373Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android -- RxAndroid 2.0 学习笔记">
<meta name="twitter:description" content="Rxjava 2.x正式版出来已经快两个月了。在之前的项目中也在使用Rx。但却一直没有时间对整个的知识进行梳理，恰好今天抽出时间，也系统的再学习一遍RxJava/RxAndroid  RxJava的使用一、观察者/被观察者1、前奏：在观察者之前就要先提下backpressure这个概念。简单来说，backpressure是在异步场景中，被观察者发送事件速度远快于观察者的处理速度时，告诉被观察者降低">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1285832-79b2c34ae347d7a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Android -- RxAndroid 2.0 学习笔记</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://www.jianshu.com/u/4215db84d54e">JianShu</a></li>
         
          <li><a href="https://github.com/LavenderStream">GitHub</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/12/28/AndroidStudio-将linux-命令放到-android-studio-终端/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2016/12/08/Android-使用微信登入退出的时候应用闪屏/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&text=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&is_video=false&description=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android -- RxAndroid 2.0 学习笔记&body=Check out this article: https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&name=Android -- RxAndroid 2.0 学习笔记&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RxJava的使用"><span class="toc-number">1.</span> <span class="toc-text">RxJava的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、观察者-被观察者"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、观察者/被观察者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observable"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">Observable</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Android -- RxAndroid 2.0 学习笔记
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">Tiny</span>
      </span>
      
    <div class="postdate">
        <time datetime="2016-12-24T06:26:00.000Z" itemprop="datePublished">2016-12-24</time>
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/top/">top</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Rxjava 2.x正式版出来已经快两个月了。在之前的项目中也在使用Rx。但却一直没有时间对整个的知识进行梳理，恰好今天抽出时间，也系统的再学习一遍RxJava/RxAndroid</p>
<hr>
<h1 id="RxJava的使用"><a href="#RxJava的使用" class="headerlink" title="RxJava的使用"></a>RxJava的使用</h1><h3 id="一、观察者-被观察者"><a href="#一、观察者-被观察者" class="headerlink" title="一、观察者/被观察者"></a>一、观察者/被观察者</h3><p>1、前奏：<br>在观察者之前就要先提下<strong>backpressure</strong>这个概念。简单来说，<strong>backpressure</strong>是在异步场景中，被观察者发送事件速度远快于观察者的处理速度时，告诉被观察者降低发送速度的策略。</p>
<p>2、在2.0中有以下几种观察者</p>
<ul>
<li>Observable/Observer</li>
<li>Flowable/Subscriber</li>
<li>Single/SingleObserver</li>
<li>Completable/CompletableObserver</li>
<li>Maybe/MaybeObserver</li>
</ul>
<p>依次的来看一下：</p>
<h4 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">.just(1, 2, 3)</span><br><span class="line">.subscribe(new Observer &lt; Integer &gt; () &#123;</span><br><span class="line">@Override public void onSubscribe(Disposable d) &#123;&#125;</span><br><span class="line">@Override public void onNext(Integer value) &#123;&#125;</span><br><span class="line">@Override public void onError(Throwable e) &#123;&#125;</span><br><span class="line">@Override public void onComplete() &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里要提的就是onSubscribe(Disposable d)，disposable用于取消订阅。<br>就用简单的just这个操作符来分析一下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">@SchedulerSupport(SchedulerSupport.NONE) </span><br><span class="line">public static &lt; T &gt; Observable &lt; T &gt; just(T item1, T item2, T item3, T item4) &#123;</span><br><span class="line">    ObjectHelper.requireNonNull(item1, &quot;The first item is null&quot;);</span><br><span class="line">    ObjectHelper.requireNonNull(item2, &quot;The second item is null&quot;);</span><br><span class="line">    ObjectHelper.requireNonNull(item3, &quot;The third item is null&quot;);</span><br><span class="line">    ObjectHelper.requireNonNull(item4, &quot;The fourth item is null&quot;);</span><br><span class="line"></span><br><span class="line">    return fromArray(item1, item2, item3, item4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@SchedulerSupport(SchedulerSupport.NONE) </span><br><span class="line">public static &lt; T &gt; Observable &lt; T &gt; fromArray(T...items) &#123;</span><br><span class="line">    ObjectHelper.requireNonNull(items, &quot;items is null&quot;);</span><br><span class="line">    if (items.length == 0) &#123;</span><br><span class="line">        return empty();</span><br><span class="line">    &#125; else if (items.length == 1) &#123;</span><br><span class="line">        return just(items[0]);</span><br><span class="line">    &#125;</span><br><span class="line">    return RxJavaPlugins.onAssembly(new ObservableFromArray &lt; T &gt; (items));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@Override </span><br><span class="line">public void subscribeActual(Observer &lt; ?super T &gt; s) &#123;</span><br><span class="line">    FromArrayDisposable &lt; T &gt; d = new FromArrayDisposable &lt; T &gt; (s, array);</span><br><span class="line">    s.onSubscribe(d);</span><br><span class="line">    if (d.fusionMode) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    d.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override </span><br><span class="line">public void dispose() &#123;</span><br><span class="line">    disposed = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override </span><br><span class="line">public boolean isDisposed() &#123;</span><br><span class="line">    return disposed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void run() &#123;</span><br><span class="line">    T[] a = array;</span><br><span class="line">    int n = a.length;</span><br><span class="line">    for (int i = 0; i &lt; n &amp;&amp; !isDisposed(); i++) &#123;</span><br><span class="line">        T value = a[i];</span><br><span class="line">        if (value == null) &#123;</span><br><span class="line">            actual.onError(new NullPointerException(&quot;The &quot; + i + &quot;th element is null&quot;));</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        actual.onNext(value);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!isDisposed()) &#123;</span><br><span class="line">        actual.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>just实际调用了<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在取消绑定是我们可以将Disposable添加到CompositeDisposable中或者直接调用Disposable的dispose() 方法在流的任意位置取消。</span><br><span class="line"></span><br><span class="line">此外， 为了简化代码，我使用了Consumer作为观察者（可以当成1.0时候的Action1 、ActionX）```subscribe```的返回值就是一个Disposable (```subscribe``` 的返回值根据传入的参数不同，也有不同)我把这个对象添加到CompositeDisposable，并在中途取消，但发射器仍然会把所有的数据全都发射完。因为LambdaSubscriber（也就是传入Consumer 所构造的观察者）的```dispose``` 和 ``` isDispose ``` 略有不同，并不是简简单单的true/false， 说实话，我没看懂Consumer的这两个方法干了什么...........尴尬</span><br></pre></td></tr></table></figure></p>
<p>LambdaSubscriber 瞅瞅</p>
<p>@Override<br>public void dispose() {<br>cancel();<br>}</p>
<p>@Override<br>public boolean isDisposed() {<br>  return get() == SubscriptionHelper.CANCELLED;<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Flowable </span><br><span class="line">是2.0之后用的最多的观察者了，他与上一个的区别在于支持背压，也就是说，下游会知道上游有多少数据，所以他Subscriber会是这样</span><br></pre></td></tr></table></figure></p>
<p>Flowable<br>.just(1, 2, 3, 4)<br>.subscribe(new Subscriber &lt; Integer &gt; () {<br>@Override public void onSubscribe(Subscription s) {<br>  s.request(Long.MAX_VALUE);<br>}<br>@Override public void onNext(Integer integer) {}<br>@Override public void onError(Throwable t) {}<br>@Override public void onComplete() {}<br>});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```onSubscribe``` 这个回调传出了一个Subscription， 我们要指定他传出数据的大小， 调用他的```request()``` 方法。如没有要求可以传入一个Long的最大数值```Long.MAX_VALUE```。</span><br><span class="line">要说明一下，request这个方法若不调用,下游的onNext与OnComplete都不会调用；若你写的数量小于，只会传你的个数，但是不会调用onComplete方法,可以看下```FlowableFromArray```的```slowPath```方法</span><br></pre></td></tr></table></figure></p>
<p>@Override void slowPath(long r) {<br>    long e = 0;<br>    T[] arr = array;<br>    int f = arr.length;<br>    int i = index;<br>    Subscriber &lt; ?super T &gt; a = actual;<br>    for (;;) {<br>        while (e != r &amp;&amp; i != f) {<br>            if (cancelled) {<br>                return;<br>            }<br>            T t = arr[i];<br>            if (t == null) {<br>                a.onError(new NullPointerException(“array element is null”));<br>                return;<br>            } else {<br>                a.onNext(t);<br>            }<br>            e++;<br>            i++;<br>        }<br>        if (i == f) {<br>            if (!cancelled) {<br>                a.onComplete();<br>            }<br>            return;<br>        }<br>        r = get();<br>        if (e == r) {<br>            index = i;<br>            r = addAndGet( - e);<br>            if (r == 0L) {<br>                return;<br>            }<br>            e = 0L;<br>        }<br>    }<br>}<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">需要if (i == f) f 是这个数据的大小，i是当前发送数据的个数,所以不会调用onComplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 休息一下</span><br><span class="line">这是几种被观察者实现的接口</span><br><span class="line">* Observable 接口 ObservableSource </span><br><span class="line">* Flowable 接口 Publisher</span><br><span class="line">* Single 接口 SingleSource</span><br><span class="line">* Completable 接口 CompletableSource </span><br><span class="line">* Maybe 接口 MaybeSource</span><br><span class="line"></span><br><span class="line">梳理完了两个被观察者，发现Flowable支持背压，父类是Publisher；Observable不支持背压，父类是ObservableSource，他们的实现方式，与其的操作符，到最后的观察者，都有些不同，他们是完全独立开的。各自之间也互不影响。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Single</span><br><span class="line">单值相应的模式: 就是只有一个值呗？</span><br><span class="line">#### Completable</span><br><span class="line">表示没有任何值但仅指示完成或异常的延迟计算。</span><br><span class="line">#### Maybe</span><br><span class="line">maybe 可以当成上面两个的合体吧！</span><br><span class="line"></span><br><span class="line">后面的三种，就不细掰了，我就是这么不求甚解。</span><br><span class="line"></span><br><span class="line">### 二、操作符</span><br><span class="line">操作符基本就没有改变，但还是会发现，我擦，from没了，可以使用fromIterable</span><br><span class="line">之前的actionx 也替换了Action  \ Consumer  \ BiConsumer</span><br><span class="line">Func也跟action一样， 名字改变了Function</span><br><span class="line"></span><br><span class="line">感觉这样是正经Rx了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 三、线程切换</span><br><span class="line">当然现场切换没有发生改变，用法还是一样，但是之前没有看过源码，不知道怎样神奇的把线程切换了，难道是来自东方的神秘力量。趁着还有时间，撸一下代码。</span><br><span class="line">在调用```subscribeOn(Schedulers.io())```之后，会创建ObservableSubscribeOn</span><br></pre></td></tr></table></figure></p>
<p>parent.setDisposable(scheduler.scheduleDirect(new Runnable() {<br>@Override<br>public void run() {<br>        source.subscribe(parent);<br>    }<br>}<br>));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">在这个过程中，会把source也就是ObservableSource在线程中订阅，同时也把把传入的Observer变成SubscribeOnObserver。若指定的是io线程，可以在```IoScheduler```中看见对线程的管理</span><br><span class="line">在调用```observeOn(AndroidSchedulers.mainThread())```时，会产生一个ObservableObserveOn，同时还会把Observer变成ObserveOnObserver，可以发现在```HandlerScheduler```，在ui线程调用了ObserveOnObserver的```run```方法</span><br><span class="line"></span><br><span class="line">### 四、Rxjava的数据传递</span><br><span class="line">Rxjava是我在工作这几个月最喜欢的框架，没有之一。完全解决了我这个有洁癖的人在打代码时的玻璃心。</span><br><span class="line">虽然重复造轮轮子是没有必要的（我也造不出来），但是为了全面的了解Rxjava，我也准备简单的实现一下，数据在每个操作符之中传输的整个过程。</span><br><span class="line"></span><br><span class="line">在实现之前先猜想一下大概的过程吧：</span><br><span class="line">我的需求是在一个static方法中产生一个数值，并且通过一层层的接口传递下去，下面的操作符的人参是上一个的返回值，最后输出，我就模仿着Rx的 Maybe 的名字实现吧。</span><br><span class="line">* 首先我要一直‘点’下去的话Maybe 一定要返回自己</span><br><span class="line">* 接口要一层层的传进去，这样的话就可以在发射数据时，发原始数据传入这个一堆的接口，然后每个接口计算自己的实现。</span><br><span class="line">* 最后返回结果</span><br><span class="line"></span><br><span class="line">之后就是仿造源码完成这段需求了，当然这些方法也都简单写了，就是为了弄清楚思路：</span><br><span class="line"></span><br><span class="line">1、创建一个MaybeSource，我们的Maybe 和 各个操作符都会实现它。</span><br></pre></td></tr></table></figure></p>
<p>public interface MaybeSource {<br>     void subscribe(MaybeObserver observer);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2、创建一个MaybeObserver， 这就是最后绑定的时候的接口</span><br></pre></td></tr></table></figure></p>
<p>public interface MaybeObserver {<br>    void onSuccess(int value);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3、创建Function， 这个在操作符中用于实现</span><br></pre></td></tr></table></figure></p>
<p>public interface Function {<br>    int apply(int t);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4、当然少不了Maybe， 这里就实现just和map两个方法吧</span><br></pre></td></tr></table></figure></p>
<p>public abstract class Maybe implements MaybeSource {<br>    public static Maybe just(int item) {<br>        return new MaybeJust(item);<br>    }</p>
<pre><code>public final Maybe map(Function mapper) {
    return new MaybeMap(this, mapper);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5、just实际返回的对象是MaybeJust，他的父类是Maybe</span><br></pre></td></tr></table></figure></p>
<p>public class MaybeJust extends Maybe {<br>    final int value;</p>
<pre><code>public MaybeJust(int value) {
    this.value = value;
}

@Override
public void subscribe(MaybeObserver observer) {
    observer.onSuccess(value);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6、map实际返回的对象是MaybeMap，他的父类是Maybe</span><br></pre></td></tr></table></figure></p>
<p>public class MaybeMap extends Maybe {<br>    final Function mapper;<br>    final MaybeSource source;</p>
<pre><code>public MaybeMap(MaybeSource source, Function mapper) {
    this.source = source;
    this.mapper = mapper;
}

@Override
public void subscribe(MaybeObserver observer) {
    source.subscribe(new MapMaybeObserver(observer, mapper));
}

static final class MapMaybeObserver implements MaybeObserver {
    final MaybeObserver actual;

    final Function mapper;

    MapMaybeObserver(MaybeObserver actual, Function mapper) {
        this.actual = actual;
        this.mapper = mapper;
    }

    @Override
    public void onSuccess(int value) {
        this.actual.onSuccess(this.mapper.apply(value));
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7、在main中可以这么运行</span><br></pre></td></tr></table></figure></p>
<p>Maybe<br>.just(1)<br>.map(new Function() {</p>
<pre><code>@Override
public int apply(int t) {
    return t + 1;
}
</code></pre><p>}).map(new Function() {</p>
<pre><code>@Override
public int apply(int t) {
    return t * 4;
}
</code></pre><p>}).subscribe(new MaybeObserver() {</p>
<pre><code>@Override
public void onSuccess(int value) {
    System.out.println(value);
}
</code></pre><p>});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">8、运行结果，传入1，先+1， 在 * 4，最后结果应该是8</span><br><span class="line"></span><br><span class="line">![Paste_Image.png](http://upload-images.jianshu.io/upload_images/1285832-459853eb386d986c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line">得到了期望的结果</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># RxJava 2.0 + Retrofit 2 .0</span><br><span class="line">之前做过一个项目，没用什么架构，也没什么封装。但对我帮助最大的是，之前是不能接受这样的代码的，感觉看上去脑袋都大了。但看习惯了， 也就习惯了。</span><br><span class="line">但平时自己弄个小项目还是使用mvp，自己的洁癖可能更加强烈一点</span><br><span class="line"></span><br><span class="line">在Retrofit 中选择了Flowable作为返回值，支持背压，在2.0之后应该最为常用</span><br></pre></td></tr></table></figure></p>
<p>@GET(“/“)<br>Flowable<responsebody> getText();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在RxJava 2.0 中使用CompositeDisposable做解除绑定的操作， Consumer 回调中使用了三个Consumer，作为成功、失败、完成的回调</span><br></pre></td></tr></table></figure></responsebody></p>
<pre><code>public &lt;T&gt; void addSubscription(Flowable flowable,
    final RxSubscriber&lt;T&gt; subscriber) {
    if (mCompositeDisposable == null) {
        mCompositeDisposable = new CompositeDisposable();
    }

    if (subscriber == null) {
        Log.e(TAG, &quot;rx callback is null&quot;);

        return;
    }

    Disposable disposable = flowable.subscribeOn(Schedulers.io())
                                    .observeOn(AndroidSchedulers.mainThread())
                                    .subscribe(new Consumer&lt;T&gt;() {
                @Override
                public void accept(T o) throws Exception {
                    subscriber.onNext(o);
                }
            },
            new Consumer&lt;Throwable&gt;() {
                @Override
                public void accept(Throwable throwable)
                    throws Exception {
                    subscriber.onError(throwable);
                }
            },
            new Action() {
                @Override
                public void run() throws Exception {
                    subscriber.onComplete();
                }
            });
</code></pre><p><code>`</code></p>
<p>此外，之前的项目后台接口也是奇葩，同一个人写的接口，接口的返回格式更是多种多样，还不改，没办法，客户端只能将就着服务端，谁叫我们是新来的呢。遇到这种问题，就不直接转成对象格式了，先转成ResponseBody得到Body，再拿出string来。<br>okhttp中response的body对象就是这个ResponseBody，他的string() 方法就可以获得整个body，然后再做json解析吧</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-79b2c34ae347d7a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1285832-79ec842b4f155cb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://www.jianshu.com/u/4215db84d54e">JianShu</a></li>
         
          <li><a href="https://github.com/LavenderStream">GitHub</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RxJava的使用"><span class="toc-number">1.</span> <span class="toc-text">RxJava的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、观察者-被观察者"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、观察者/被观察者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observable"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">Observable</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&text=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&is_video=false&description=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android -- RxAndroid 2.0 学习笔记&body=Check out this article: https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&title=Android -- RxAndroid 2.0 学习笔记"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://lavenderstream.github.io/2016/12/24/Android-RxAndroid-2-0-学习笔记/&name=Android -- RxAndroid 2.0 学习笔记&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Tiny
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://www.jianshu.com/u/4215db84d54e">JianShu</a></li>
         
          <li><a href="https://github.com/LavenderStream">GitHub</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


